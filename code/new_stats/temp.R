
library(tidyverse)
library(dplyr)
library(stringr)


#Working directory should be the Psychopy experiment directory.
proje_wd <- "/Users/kihossei/Documents/GitHub/memory-for-error-dataset"
setwd(proje_wd)

#v3 data files also work for this script.
input_raw_path <- paste(proje_wd, "sourcedata", "raw","psychopy", sep ="/", collapse = NULL) # input data directory
input_organized_path <- paste(proje_wd, "derivatives", "preprocessed", "psychopy", "organizer_output", sep ="/", collapse = NULL) # input directory for data files generated by the organizer script!
output_path <- paste(proje_wd, "derivatives", "preprocessed", "psychopy", "stat_output", sep ="/", collapse = NULL) # output directory
proc_fileName <- "processed_data_mfe_b_Proj_n1.csv" # output filename
flanker_csv_fileName <- "_mfe_b_flankerDat_n1.csv" # each output csv file will have this on its filename
surprise_csv_fileName <- "_mfe_b_surpriseDat_n1.csv" # each output csv file will have this on its filename


## creating a list of all raw data csv files in the input folder.
raw_datafiles_list <- c() # an empty list that will be filled in the next "for" loop!
csvSelect <- list.files(input_raw_path, pattern = ".csv") # listing only csv files
for (i in 1:length(csvSelect)){
  temp_for_file <- ifelse (str_detect(csvSelect[i], "mfe_b", negate = FALSE), 1, 0)
  if (temp_for_file == 1){
    temp_list <- csvSelect[i]
    raw_datafiles_list <- c(raw_datafiles_list, temp_list)
  }
}

# Creating the main empty dataframe that will be filled with the data from the loop below:
temp_rt_df <- setNames(data.frame(matrix(ncol = 3, nrow = 0)), c("participant_id", "num_tooSlow_surpTrials", "num_tooFast_surpTrials"))

for (subject in 1:length(raw_datafiles_list)){
  #for this participant, find the raw csv file
  psychopy_file <- paste(input_raw_path,raw_datafiles_list[subject], sep = "/", collapse = NULL)

  #read in the data for this participant, establish id, and remove extraneous variables
  psychopyDat <- read.csv(file = psychopy_file, stringsAsFactors = FALSE, na.strings=c("", "NA"))
  participant_id <- psychopyDat$id[1]

  # Load this participant's surprise data frames

  surprise_name <- paste0(participant_id, surprise_csv_fileName, sep = "", collapse = NULL)
  surprise_df <- read.csv(file = paste(input_organized_path, surprise_name, sep = "/", collapse = NULL), stringsAsFactors = FALSE, na.strings=c("", "NA"))
  num_tooSlow_surpTrials <-  surprise_df$num_tooSlow_surpTrials[1]
  num_tooFast_surpTrials  <- surprise_df$num_tooFast_surpTrials[1]

  #### filling the main data frame
  temp_rt_df[nrow(temp_rt_df) + 1,] <-c(participant_id, num_tooSlow_surpTrials, num_tooFast_surpTrials)

}
